// ----- 追加： HTML を優先して貼り付けさせる -----
const editable = document.getElementById('inputText');
editable.addEventListener('paste',  e => {
  e.preventDefault();                       // 標準の貼り付けを止める
  const clip = e.clipboardData || window.clipboardData;
  const html = clip.getData('text/html');
  const txt  = clip.getData('text/plain');
  // HTML があればそちらを挿入。無ければプレーンテキスト
  document.execCommand('insertHTML', false, html || txt);
});
// -----------------------------------------------

// ↓ 以下は前回お渡ししたレベル判定ロジックそのまま ↓
document.getElementById('processButton').addEventListener('click', () => {
  const html = editable.innerHTML;
  if(!html){document.getElementById('result').textContent='Nothing pasted';return;}

  const doc   = new DOMParser().parseFromString(html,'text/html');
  const pack  ={A1:[],A2:[],B1:[],B2:[],C1:[],C2:[],naContent:[],naOthers:[]};

  const norm = c=>{
    c=c.trim().toLowerCase();
    const m=c.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
    if(m){const h=x=>('0'+(+x).toString(16)).slice(-2);return '#'+h(m[1])+h(m[2])+h(m[3]);}
    if(/^#([0-9a-f]{3})$/i.test(c)) return '#'+c[1]+c[1]+c[2]+c[2]+c[3]+c[3];
    return c;
  };

  doc.querySelectorAll('span').forEach(sp=>{
    const st  = sp.getAttribute('style')||'';
    const txt = sp.textContent.trim();
    if(!txt) return;

    let col = '';                     // color だけ抜き取る
    st.split(';').forEach(s=>{
      if(s.includes('color')&&!s.includes('background')) col=s.split(':')[1]||'';
    });
    col = norm(col);
    const bold = /font-weight\s*:\s*(bold|[6-9]\d\d)/i.test(st);

    let lv = 'naOthers';
    if(col==='#32cd32')               lv = bold ? 'A2':'A1';
    else if(col==='#0000ff')          lv = bold ? 'B2':'B1';
    else if(col==='#ff0000')          lv = bold ? 'C2':'C1';
    else if(col==='#ffa500')          lv = 'naContent';

    if(!pack[lv].includes(txt)) pack[lv].push(txt);
  });

  const row=l=>`<tr><td>${l}</td><td>${pack[l].join(' / ')}</td></tr>`;
  document.getElementById('result').innerHTML =
    `<table><tr><th>Level</th><th>Words</th></tr>`+
    ['A1','A2','B1','B2','C1','C2','naContent','naOthers'].map(row).join('')+
    `</table>`;
});
