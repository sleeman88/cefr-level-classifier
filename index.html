<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>CVLA – CEFR Vocabulary Table Converter</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;padding:1.5rem;line-height:1.6}
  #raw{width:100%;height:260px;border:1px solid #bbb;border-radius:6px;padding:8px;font-family:"Courier New",monospace;font-size:.9rem}
  button{margin-top:12px;padding:6px 16px;font-size:1rem;border:none;border-radius:4px;cursor:pointer;background:#007bff;color:#fff}
  button:hover{background:#0063cc}
  table{width:100%;border-collapse:collapse;margin-top:22px}
  th,td{border:1px solid #ccc;padding:6px 8px;text-align:left}
  th{background:#f0f0f0}
  td:nth-child(2){word-break:break-word}
  .count{font-size:.85rem;color:#555}
</style>
</head>
<body>
<h2>CVLA Color‑coded Result → Easy‑to‑read CEFR Table</h2>
<p>1. <strong>CVLA</strong> で表示されたカラフルな HTML 部分（&lt;div class="border" … &gt; から &lt;/div&gt; まで）を<strong>そのまま</strong>下のテキストエリアに貼り付ける。<br>
2. <strong>Convert</strong> をクリックすると、重複なし＆レベル別の表が生成される。</p>

<textarea id="raw" placeholder="ここに CVLA の結果 HTML を貼り付けてください"></textarea>
<button id="convert">Convert</button>

<div id="output"></div>

<script>
// ---------------------------------------------------------------------------
function classifyColor(rgb, bold){
  // rgb is like "rgb(50, 205, 50)"
  if(/rgb\(\s*50[,\s]*205[,\s]*50/i.test(rgb)) return bold?"A2":"A1";           // #32cd32
  if(/rgb\(\s*0[,\s]*0[,\s]*255/i.test(rgb))  return bold?"B2":"B1";            // blue
  if(/rgb\(\s*255[,\s]*0[,\s]*0/i.test(rgb))  return bold?"C2":"C1";            // red
  if(/rgb\(\s*255[,\s]*165[,\s]*0/i.test(rgb))return "NA content";              // orange
  return "NA other";
}

document.getElementById("convert").addEventListener("click",()=>{
  const raw = document.getElementById("raw").value.trim();
  if(!raw){alert("まず入力欄に HTML を貼り付けてください。");return;}

  // パース用ダミーノードを DOM に差し込み、computedStyle を使う
  const wrapper=document.createElement("div");
  wrapper.innerHTML=raw;
  wrapper.style.display="none"; // 画面に出さない
  document.body.appendChild(wrapper);

  const levels={"A1":new Set(),"A2":new Set(),"B1":new Set(),"B2":new Set(),"C1":new Set(),"C2":new Set(),"NA content":new Set(),"NA other":new Set()};

  wrapper.querySelectorAll("span").forEach(span=>{
    const word=span.textContent.trim();
    if(!word||!/\w/.test(word))return; // 文字を含まないものは無視
    const style=window.getComputedStyle(span);
    const color=style.color;
    const weight=parseInt(style.fontWeight)||400;
    const bold=weight>=600;
    const level=classifyColor(color,bold);
    levels[level].add(word);
  });

  // 完了したらダミーを削除
  document.body.removeChild(wrapper);

  // HTML table 生成
  const order=["A1","A2","B1","B2","C1","C2","NA content","NA other"];
  let html="<table><thead><tr><th>Level</th><th>Words <span class=\"count\">(unique)</span></th></tr></thead><tbody>";
  order.forEach(lvl=>{
    const arr=[...levels[lvl]].sort((a,b)=>a.localeCompare(b,'en',{sensitivity:'base'}));
    if(arr.length) html+=`<tr><td>${lvl}</td><td>${arr.join(', ')}</td></tr>`;
  });
  html+="</tbody></table>";
  document.getElementById("output").innerHTML=html;
});
</script>
</body>
</html>
